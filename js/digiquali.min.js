window.digiquali||(window.digiquali={},window.digiquali.scriptsLoaded=!1),window.digiquali.scriptsLoaded||(window.digiquali.init=function(){window.digiquali.load_list_script()},window.digiquali.load_list_script=function(){if(!window.digiquali.scriptsLoaded){var e=void 0,t=void 0;for(e in window.digiquali)for(t in window.digiquali[e].init&&window.digiquali[e].init(),window.digiquali[e])window.digiquali[e]&&window.digiquali[e][t]&&window.digiquali[e][t].init&&window.digiquali[e][t].init();window.digiquali.scriptsLoaded=!0}},window.digiquali.refresh=function(){var e=void 0,t=void 0;for(e in window.digiquali)for(t in window.digiquali[e].refresh&&window.digiquali[e].refresh(),window.digiquali[e])window.digiquali[e]&&window.digiquali[e][t]&&window.digiquali[e][t].refresh&&window.digiquali[e][t].refresh()},$(document).ready(window.digiquali.init)),window.digiquali.control={},window.digiquali.control.init=function(){window.digiquali.control.event()},window.digiquali.control.event=function(){$(document).on("click",".validateButton",window.digiquali.control.getAnswerCounter),$(document).on("change","#fk_sheet",window.digiquali.control.showSelectObjectLinked),$(document).on("click",".clipboard-copy",window.digiquali.control.copyToClipboard),$(document).on("change","#productId",window.digiquali.control.refreshLotSelector),$(document).on("click",".switch-public-control-view",window.digiquali.control.switchPublicControlView),$(document).on("click",".photo-sheet-category",window.digiquali.control.getSheetCategoryID),$(document).on("click",".photo-sheet-sub-category",window.digiquali.control.getSheetSubCategoryID),$(document).on("click",".photo-sheet",window.digiquali.control.getSheetID),$(document).on("click","[data-toggle-action]",function(){var e=$(this).data("toggle-action"),t=$(this).data("toggle-key");e&&t&&window.saturne.utils.toggleSetting.call(this,e,t)})},window.digiquali.control.getAnswerCounter=function(e){let t=0;jQuery("#tablelines").children().each(function(){0<$(this).find(".answer.active").length&&(t+=1)}),document.cookie="answerCounter="+t},window.digiquali.control.showSelectObjectLinked=function(){var e=$(this).val(),t=window.saturne.toolbox.getToken(),i=window.saturne.toolbox.getQuerySeparator(document.URL),i=document.URL+i+"fk_sheet="+e+"&token="+t;window.saturne.loader.display($(".linked-objects")),$.ajax({url:i,type:"POST",processData:!1,contentType:!1,success:function(e){$(".linked-objects").replaceWith($(e).find(".linked-objects"))},error:function(){}})},window.digiquali.control.copyToClipboard=function(e){var t=$(".copy-to-clipboard").attr("value");navigator.clipboard.writeText(t).then(()=>{$(".clipboard-copy").animate({backgroundColor:"#59ed9c"},200,()=>{$(".clipboard-copy").attr("class","fas fa-check  clipboard-copy"),$(this).tooltip({items:".clipboard-copy",content:$("#copyToClipboardTooltip").val()}),$(this).tooltip("open"),$(".clipboard-copy").attr("style","")})})},window.digiquali.control.refreshLotSelector=function(e){var t=document.getElementById("add_control_equipment"),t=new FormData(t),i=window.saturne.toolbox.getToken(),t=t.get("productId"),i=document.URL+"&token="+i;i+="&fk_product="+t,window.saturne.loader.display($(".product-lot")),$.ajax({url:i,type:"POST",processData:!1,contentType:!1,success:function(e){$(".product-lot").replaceWith($(e).find(".product-lot"))},error:function(){}})},window.digiquali.control.switchPublicControlView=function(){var e=$(this).data("route"),t=window.saturne.toolbox.getToken();$.ajax({url:document.URL+"&route="+e+"&token="+t,type:"POST",processData:!1,contentType:!1,success:function(e){$("#publicControlHistory").replaceWith($(e).find("#publicControlHistory"))},error:function(){}})},window.digiquali.control.getSheetCategoryID=function(){let t=$(this).attr("value");var e=window.saturne.toolbox.getToken(),i=window.saturne.toolbox.getQuerySeparator(document.URL);window.saturne.loader.display($(".sheet-images-container")),$.ajax({url:document.URL+i+"sheetCategoryID="+t+"&token="+e,type:"POST",processData:!1,contentType:!1,success:function(e){$(".sheet-images-container").replaceWith($(e).find(".sheet-images-container")),$(".photo-sheet-category[value="+t+"]").css("border","3px solid #0d8aff"),$(".photo-sheet-category[value="+t+"]").addClass("photo-sheet-category-active"),$(".linked-objects").replaceWith($(e).find(".linked-objects"))},error:function(){}})},window.digiquali.control.getSheetSubCategoryID=function(){let t=$(".photo-sheet-category-active").attr("value"),i=$(this).attr("value");var e=window.saturne.toolbox.getToken(),o=window.saturne.toolbox.getQuerySeparator(document.URL);window.saturne.loader.display($(".sheet-images-container")),$.ajax({url:document.URL+o+"sheetCategoryID="+t+"&sheetSubCategoryID="+i+"&token="+e,type:"POST",processData:!1,contentType:!1,success:function(e){$(".sheet-images-container").replaceWith($(e).find(".sheet-images-container")),$(".photo-sheet-category[value="+t+"]").css("border","3px solid #0d8aff"),$(".photo-sheet-category[value="+t+"]").addClass("photo-sheet-category-active"),$(".photo-sheet-sub-category[value="+i+"]").css("border","3px solid #0d8aff"),$(".photo-sheet-sub-category[value="+i+"]").addClass("photo-sheet-sub-category-active"),$(".linked-objects").replaceWith($(e).find(".linked-objects"))},error:function(){}})},window.digiquali.control.getSheetID=function(){let t=$(this).attr("data-object-id");var e=$(".photo-sheet-category-active").attr("value"),i=$(".photo-sheet-sub-category-active").attr("value"),o=window.saturne.toolbox.getToken(),n=window.saturne.toolbox.getQuerySeparator(document.URL);window.saturne.loader.display($(".sheet-elements")),window.saturne.loader.display($(".linked-objects")),$.ajax({url:document.URL+n+"fk_sheet="+t+"&sheetCategoryID="+e+"&sheetSubCategoryID="+i+"&token="+o,type:"POST",processData:!1,contentType:!1,success:function(e){$(".sheet-elements").replaceWith($(e).find(".sheet-elements")),$(".photo-sheet[data-object-id="+t+"]").css("border","3px solid #0d8aff"),$(".linked-objects").replaceWith($(e).find(".linked-objects"))},error:function(){}})},window.digiquali.object={},window.digiquali.object.init=function(){window.digiquali.object.event(),window.digiquali.object.placePercents()},window.digiquali.object.event=function(){$(document).on("change",".object-table.linked-objects select",window.digiquali.object.disableOtherSelectors),$(document).on("click",".answer:not(.disable)",window.digiquali.object.selectAnswer),$(document).on("input",".input-answer:not(.disable)",window.digiquali.object.selectAnswer),$(document).on("keyup",".question-comment",window.digiquali.object.showCommentUnsaved),$(document).on("change",".question-answer",window.digiquali.object.changeStatusQuestion),$(document).on("click",".answer:not(.disable)",window.digiquali.object.changeStatusQuestion),$(document).on("input",'.question-answer[type="range"]',window.digiquali.object.rangePercent)},window.digiquali.object.disableOtherSelectors=function(){var e=document.getElementById("createObjectForm"),e=new FormData(e),t=$(this).attr("id");0<=e.get(t)?$(".object-table.linked-objects").find("select").not("#"+t).attr("disabled",1):$(".object-table.linked-objects").find("select").not("#"+t).removeAttr("disabled")},window.digiquali.object.selectAnswer=function(){var t=$(this).closest(".select-answer.answer-cell"),e=t.attr("data-questionId"),i=$(this).closest(".table-id-"+e).attr("data-publicInterface"),o=$(this).closest(".table-id-"+e).attr("data-autoSave");let n="";var a=$(this).hasClass("answer")?$(this).attr("value"):$(this).val(),s=$(this).closest(".table-id-"+e).find("#comment"+e).val();if($(this).closest(".table-cell").hasClass("select-answer")){if($(this).hasClass("multiple-answers")){$(this).closest("span").toggleClass("active");let e=[];t.find(".multiple-answers.active").each(function(){e.push($(this).attr("value"))}),n=e}else $(this).closest(".table-cell").find(".answer.active").css("background-color","#fff"),$(this).closest(".table-cell").find("span").removeClass("active"),$(this).closest("span").addClass("active"),n=a;$(this).hasClass("active")?(t=$(this).closest(".answer-cell").find(".answer-color-"+$(this).attr("value")).val(),$(this).attr("style",$(this).attr("style")+" background:"+t+";")):$(this).attr("style",$(this).attr("style")+" background:#fff;"),$(this).closest(".answer-cell").find(".question-answer").val(n)}i||1!=o||$(this).hasClass("multiple-answers")?window.digiquali.object.updateButtonsStatus():window.digiquali.object.saveAnswer(e,n,s)},window.digiquali.object.changeStatusQuestion=function(){$(this).closest(".question").addClass("question-complete")},window.digiquali.object.showCommentUnsaved=function(){$(this).hasClass("show-comment-unsaved-message")||$(".question-answer-container").hasClass("question-answer-container-pwa")||($(this).after('<p style="color:red;">Commentaire non enregistr√©</p>'),$(this).addClass("show-comment-unsaved-message")),window.digiquali.object.updateButtonsStatus()},window.digiquali.object.updateButtonsStatus=function(){$("#saveButton").removeClass("butActionRefused"),$("#saveButton").addClass("butAction"),$("#saveButton").css("background","#0d8aff"),$(".fa-circle").css("display","inline"),$("#saveButton").attr("onclick",'$("#saveObject").submit()'),$(".validateButton").removeClass("butAction"),$("#dialog-confirm-actionButtonValidate").removeAttr("id"),$(".validateButton").addClass("butActionRefused")},window.digiquali.object.saveAnswer=function(e,t,i){var o=window.saturne.toolbox.getToken(),n=window.saturne.toolbox.getQuerySeparator(document.URL);window.saturne.loader.display($(".table-id-"+e)),$.ajax({url:document.URL+n+"action=save&token="+o,type:"POST",data:JSON.stringify({autoSave:!0,questionId:e,answer:t,comment:i}),processData:!1,contentType:!1,success:function(e){$(".fiche").replaceWith($(e).find(".fiche")),$("#dialog-confirm-actionButtonValidate>.confirmmessage").replaceWith($(e).find("#dialog-confirm-actionButtonValidate>.confirmmessage"))},error:function(){}})},window.digiquali.object.rangePercent=function(){var e=window.saturne.toolbox.isPhone(),t=$(this),i=parseInt(t.val()),o=parseInt(t.attr("min")),n=parseInt(t.attr("max")),a=t.width(),s=t.position().left,t=t.position().top,d=e?36:70,c=($(this).parent().find(".range-percent").remove(),$('<span class="range-percent">'+$(this).val()+"%</span>")),t=(e||c.css("transform","translateX(0)"),c.addClass("badge badge-primary"),c.css("top",t-1.05*d/2-(e?10:5)+"px"),(i-o)/(n-o)),i=s+Math.round(t*a-(e?0:d/4)+-d*(t-.5));c.css("left",i),$(this).parent().append(c)},window.digiquali.object.placePercents=function(){$('.question-answer[type="range"]').each(function(){window.digiquali.object.rangePercent.call(this)})},window.digiquali.question={},window.digiquali.question.init=function(){window.digiquali.question.event()},window.digiquali.question.event=function(){$(document).on("click",".clicked-photo-preview",window.digiquali.question.previewPhoto),$(document).on("click",".ui-dialog-titlebar-close",window.digiquali.question.closePreviewPhoto),$(document).on("click","#show_photo",window.digiquali.question.showPhoto),$(document).on("click",".answer-picto .item, .wpeo-table .item",window.digiquali.question.selectAnswerPicto),$(document).on("change",'select[data-type="question-type"]',window.digiquali.question.changeQuestionType)},window.digiquali.question.previewPhoto=function(){$(this).hasClass("photo-ok")?$("#dialogforpopup").attr("style","border: 10px solid #47e58e"):$(this).hasClass("photo-ko")&&$("#dialogforpopup").attr("style","border: 10px solid #e05353")},window.digiquali.question.closePreviewPhoto=function(){$("#dialogforpopup").attr("style","border:")},window.digiquali.question.showPhoto=function(){var e=$(this);e.closest(".question-table").find(".linked-medias").toggleClass("hidden",!e.prop("checked"))},window.digiquali.question.selectAnswerPicto=function(){var e=$(this).closest(".wpeo-dropdown");$(this).closest(".content").removeClass("active"),e.find(".dropdown-toggle span").hide(),e.find(".dropdown-toggle.button-picto").html($(this).closest(".wpeo-tooltip-event").html()),e.find(".input-hidden-picto").val($(this).data("label"))},window.digiquali.question.changeQuestionType=function(){"Percentage"===$(this).val()?$(document).find("#percentage-question-step").removeClass("hidden"):$(document).find("#percentage-question-step").addClass("hidden")},window.digiquali.sheet={},window.digiquali.sheet.init=function(){window.digiquali.sheet.event()},window.digiquali.sheet.event=function(){};